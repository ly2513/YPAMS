<!DOCTYPE html>
<html>

<head>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>登录</title>

    <link href="/Static/css/bootstrap.min.css" rel="stylesheet">
    <link href="/Static/font-awesome/css/font-awesome.css" rel="stylesheet">
    <link href="/Static/css/animate.css" rel="stylesheet">
    <link href="/Static/css/style.css" rel="stylesheet">
    <link href="/Static/css/plugins/message/jquery.toastmessage.css" rel="stylesheet">
    <script src="/Static/js/jquery-2.1.1.js"></script>
    <script src="/Static/js/bootstrap.min.js"></script>

</head>

<body class="gray-bg">

    <div class="middle-box text-center loginscreen animated fadeInDown">
        <div>
            <div>
                <h1 class="logo-name" style="color:#1bb394;">IN+</h1>
            </div>
            <h3 style="color:#1bb394;">欢迎来到YPAMS后台管理系统</h3>
            <p>
            </p>
            <form class="m-t">  
                <div class="form-group">
                    <input type="TEXT" class="form-control" name="username" placeholder="请输入账号" required>
                </div>
                <div class="form-group">
                    <input type="password" class="form-control" name="password" placeholder="请输入密码" required>
                </div>
                <input type="button" class="btn btn-primary block full-width m-b" id="do-login"value="Login">
                <a href="/Admin/Login/login"><small>忘记密码?</small></a>
                <p class="text-muted text-center"><small>没有账号?</small></p>
                <a class="btn btn-sm btn-white btn-block" href="/Admin/Login/login">注册账号</a>
            </form>
            <p class="m-t"> <small>Inspinia we app framework base on Bootstrap 3 &copy; 2014</small> </p>
        </div>
    </div>

</body>
</html>
<script src="/Static/js/plugins/message/jquery.toastmessage.js"> </script>
<script src="/Static/js/custom/md5.js"> </script>
<script>
function unicode(str){
    var value='';
    for (var i = 0; i < str.length; i++) {
        value += '\\u' + left_zero_4(parseInt(str.charCodeAt(i)).toString(16));
    }
    return value;
}
function left_zero_4(str) {
    if (str != null && str != '' && str != 'undefined') {
        if (str.length == 2) {
            return '00' + str;
        }
    }
    return str;
}
function getUrlParam(name) {
    var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)"); 
    var r = window.location.search.substr(1).match(reg); 
    if (r != null) return decodeURI(r[2]); return null; //返回参数值
}

function doLogin(){
    var username = $("input[name='username']").val();

    var password = hex_md5($("input[name='password']").val());
    $.ajax({
        url:'/Admin/Login/doLogin',
        type:'POST',
        dataType:'json',
        data:{username:username,password:password},
        success:function(res){
            if (res.code == 0) {
                $().toastmessage('showSuccessToast', "登录成功");
                setTimeout(function () {
                    window.location.href = '/Admin/Index/index';
                }, 1000);
            } else {
                $().toastmessage('showErrorToast', res.msg);
            }
        }
    });
}
$(function(){
    $("#do-login").click(function(){
        doLogin();
    });
    $(document).keypress(function(e){// 验证登录
        if (e.which == 13) {
            doLogin();
        }
    });
    var msg = getUrlParam('msg');
    if (msg) {
        $().toastmessage('showErrorToast', msg);
    }
});
</script>
