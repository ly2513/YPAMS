<?php
/**
 * User: yongli
 * Date: 17/4/24
 * Time: 15:21
 * Email: yong.li@szypwl.com
 * Copyright: 深圳优品未来科技有限公司
 */
namespace App\Controllers;

use Admin\DriverModel;
use Admin\UserModel;
use YP\Core\YP_Controller as Controller;
use Elasticsearch\ClientBuilder;

/**
 * 框架默认控制器
 *
 * Class Home
 *
 * @package App\Controllers
 */
class Home extends Controller
{
    /**
     * 框架首页信息
     */
    public function index()
    {
        $this->display();
    }

    public function testElasticsearch()
    {
        $client   = ClientBuilder::create()->build();
        $userData = UserModel::select(['id', 'pid', 'name', 'nickname', 'phone'])->get()->toArray();
        foreach ($userData as $key => $value) {
            $params          = [];
            $params['body']  = [
                'id'       => $value['id'],
                'pid'      => $value['pid'],
                'name'     => $value['name'],
                'nickname' => $value['nickname'],
                'phone'    => $value['phone'],
            ];
            $params['index'] = 'emp_index';
            $params['type']  = 'emp_type';
            //Document will be indexed to log_index/log_type/autogenerate_id
            $status = $client->index($params);
            P($status);
        }
        echo 'create index done!';
    }

    public function search()
    {
        $para                                     = $this->request->getGet();
        $client                                   = ClientBuilder::create()->build();
        $params                                   = [];
        $params['index']                          = 'emp_index';
        $params['type']                           = 'emp_type';
        $params['body']['query']['match']['name'] = $para['q'];
        $params['body']['sort']                   = ['id' => ['order' => 'desc']];
        $params['size']                           = 3;
        $params['from']                           = 1;
        $rtn                                      = $client->search($params);
        P($rtn);
    }

    public function update()
    {
        $driveid = '3427670,3427683,3427664,3427708,3427712,3427725,3427679,3427723,3427736,3427746,3427732,3427756,3427763,3427780,3427816,3427813,3427810,3427830,3427824,3427818,3427835,3427823,3427847,3427865,3427867,3427864,3427872,3427866,3427900,3427898,3427901,3427923,3427919,3427909,3427942,3427911,3427938,3427967,3427977,3427979,3427986,3427990,3427996,3428002,3427999,3427989,3428010,3428000,3427974,3428024,3428050,3428064,3428056,3428013,3428054,3428078,3428082,3428074,3428092,3428088,3428090,3428109,3428117,3428124,3428127,3428140,3428149,3428154,3428151,3428111,3428161,3428169,3428133,3428181,3428183,3428129,3428195,3428170,3428217,3428237,3427997,3428244,3428258,3428260,3428261,3428268,3428277,3428297,3428273,3428326,3428334,3428361,3428377,3428357,3428373,3428378,3428345,3428465,3428490,3428495,3428513,3428535,3428537,3428543,3428565,3428566,3428571,3428600,3428612,3428552,3428620,3428636,3428657,3428658,3428665,3428675,3428656,3428659,3428683,3428690,3428700,3428731,3428704,3428667,3428732,3428735,3428750,3428756,3428759,3428773,3428824,3428844,3428854,3428859,3428865,3428878,3428873,3428882,3428901,3428910,3428929,3428908,3428905,3428917,3428939,3428909,3428943,3428960,3428925,3428962,3428949,3428996,3429004,3429020,3429024,3429033,3429039,3429050,3429061,3429071,3429087,3429126,3429134,3429158,3429141,3429181,3429188,3429172,3429197,3428842,3429229,3429230,3429117,3429244,3429298,3429315,3429330,3429344,3429333,3429347,3429354,3429339,3429361,3429370,3429379,3429387,3429392,3429400,3429393,3429402,3429412,3429419,3429425,3429435,3429445,3429451,3429461,3429476,3429488,3429504,3429508,3429515,3429522,3429526,3429541,3429539,3429545,3429554,3429582,3429576,3429604,3429616,3429624,3429633,3429639,3429655,3429653,3429672,3429693,3429720,3429724,3429736,3429739,3429748,3429774,3429780,3429791,3429814,3429812,3429819,3429823,3429834,3429832,3429847,3429859,3429862,3429870,3429872,3429873,3429871,3429880,3429879,3429883,3429884,3429886,3429888,3429891,3429890,3429896,3429901,3429897,3429899,3429903,3429904,3429905,3429910,3429911,3429908,3429913,3429916,3429917,3429918,3429921,3429922,3429923,3429926,3429925,3429924,3429912,3429928,3429937,3429938,3429942,3429941,3429944,3429946,3429947,3429949,3429953,3429894,3429954,3429952,3429948,3429955,3429957,3429960,3429963,3429964,3429961,3429967,3429959,3429966,3429965,3429971,3429974,3429969,3429977,3429976,3429980,3429985,3429984,3429987,3429982,3429981,3429988,3429990,3429993,3429997,3429992,3429999,3430001,3430002,3430003,3430007,3430005,3430009,3430004,3430008,3430014,3430011,3430012,3430018,3430021,3430019,3430027,3430023,3430030,3430031,3430029,3430034,3430035,3430041,3430039,3430042,3430038,3430043,3430037,3430048,3430071,3427812,3430058,3430096,3430099,3430102,3430116,3430126,3430129,3430125,3430136,3430138,3430139,3430157,3430149,3430147,3430173,3430180,3430195,3430193,3430189,3430191,3430198,3430207,3430172,3430205,3430186,3430199,3430221,3430215,3430222,3430236,3430258,3430252,3430266,3430277,3430280,3430272,3430286,3430281,3430292,3428234,3430298,34334305080301,3430305,3430318,3430312,3430313,3430335,3430330,3430354,3430375,3430385,3430388,3430406,3430431,3430433,3429975,3430443,3430445,3430449,3430450';
        $driveid = explode(',', $driveid);
        $sql     = '';
        foreach ($driveid as $key => $value) {
            //            $sql .= 'update  t_join_driver set receive_status=1 where id='.$value.'; '.PHP_EOL;
            $sql .= 'update  t_join_driver_problem set receive_status=1 where driver_join_id=' . $value . '; ' . PHP_EOL;
        }
        echo $sql;

    }

    public function check()
    {
        $no_real_name_id = [
            "3427708",
            "3427712",
            "3427725",
            "3427679",
            "3427723",
            "3427746",
            "3427732",
            "3427756",
            "3427780",
            "3427813",
            "3427810",
            "3427830",
            "3427824",
            "3427818",
            "3427847",
            "3427865",
            "3427867",
            "3427864",
            "3427872",
            "3427866",
            "3427900",
            "3427898",
            "3427901",
            "3427923",
            "3427919",
            "3427909",
            "3427942",
            "3427911",
            "3427938",
            "3427967",
            "3427977",
            "3427986",
            "3427990",
            "3427996",
            "3427999",
            "3427989",
            "3428010",
            "3427974",
            "3428024",
            "3428050",
            "3428064",
            "3428056",
            "3428013",
            "3428054",
            "3428078",
            "3428082",
            "3428074",
            "3428092",
            "3428090",
            "3428124",
            "3428127",
            "3428140",
            "3428149",
            "3428161",
            "3428133",
            "3428181",
            "3428183",
            "3428129",
            "3428170",
            "3428217",
            "3428237",
            "3427997",
            "3428244",
            "3428260",
            "3428261",
            "3428268",
            "3428297",
            "3428273",
            "3428326",
            "3428334",
            "3428377",
            "3428357",
            "3428373",
            "3428345",
            "3428465",
            "3428495",
            "3428513",
            "3428535",
            "3428537",
            "3428543",
            "3428566",
            "3428571",
            "3428612",
            "3428552",
            "3428657",
            "3428658",
            "3428675",
            "3428656",
            "3428659",
            "3428700",
            "3428704",
            "3428667",
            "3428735",
            "3428750",
            "3428756",
            "3428759",
            "3428824",
            "3428865",
            "3428878",
            "3428873",
            "3428901",
            "3428910",
            "3428929",
            "3428908",
            "3428905",
            "3428917",
            "3428939",
            "3428909",
            "3428943",
            "3428925",
            "3428962",
            "3428949",
            "3429004",
            "3429020",
            "3429024",
            "3429033",
            "3429039",
            "3429050",
            "3429061",
            "3429071",
            "3429126",
            "3429134",
            "3429158",
            "3429141",
            "3429181",
            "3429188",
            "3429172",
            "3429197",
            "3428842",
            "3429117",
            "3429244",
            "3429315",
            "3429330",
            "3429333",
            "3429347",
            "3429354",
            "3429339",
            "3429361",
            "3429370",
            "3429379",
            "3429392",
            "3429402",
            "3429412",
            "3429419",
            "3429425",
            "3429451",
            "3429461",
            "3429476",
            "3429504",
            "3429508",
            "3429515",
            "3429522",
            "3429526",
            "3429541",
            "3429539",
            "3429545",
            "3429576",
            "3429604",
            "3429624",
            "3429639",
            "3429655",
            "3429653",
            "3429672",
            "3429693",
            "3429720",
            "3429724",
            "3429774",
            "3429780",
            "3429791",
            "3429812",
            "3429819",
            "3429823",
            "3429832",
            "3429847",
            "3429859",
            "3429862",
            "3430172",
            "3430205",
            "3430186",
            "3430199",
            "3430221",
            "3430215",
            "3430222",
            "3430236",
            "3430258",
            "3430252",
            "3430266",
            "3430277",
            "3430280",
            "3430272",
            "3430286",
            "3430292",
            "3428234",
            "3430298",
            "3430301",
            "3430305",
            "3430312",
            "3430313",
            "3430330",
            "3430037",
            "3430048",
            "3430071",
            "3427812",
            "3430058",
            "3430096",
            "3430099",
            "3430102",
            "3430116",
            "3430125",
            "3430138",
            "3430139",
            "3430157",
            "3430149",
            "3430147",
            "3430173",
            "3430180",
            "3430193",
            "3430189",
            "3430191",
            "3430198",
            "3430375",
            "3430388",
            "3430433",
            "3429975",
            "3430443",
            "3430449",
            "3430450"
        ];

        $real_name_id = ["3427634","3427642","3427653","3427670","3427683","3427664","3427707","3427705","3427697","3427706","3427696","3427703","3427719","3427726","3427717","3427722","3427709","3427720","3427730","3427689","3427743","3427741","3427699","3427727","3427737","3427734","3427744","3427752","3427740","3427736","3427733","3427751","3427759","3427750","3427765","3427758","3427764","3427766","3427753","3427768","3427770","3427763","3427747","3427769","3427771","3427777","3427735","3427786","3427773","3427784","3427785","3427781","3427778","3427739","3427790","3427794","3427795","3427799","3427791","3427787","3427792","3427797","3427805","3427802","3427804","3427809","3427817","3427811","3427814","3427808","3427816","3427815","3427820","3427821","3427826","3427827","3427831","3427819","3427835","3427833","3427834","3427839","3427843","3427845","3427841","3427823","3427850","3427652","3427829","3427807","3427854","3427849","3427855","3427861","3427862","3427863","3427846","3427868","3427871","3427879","3427869","3427874","3427888","3427876","3427767","3427885","3427886","3427894","3427892","3427896","3427884","3427897","3427902","3427915","3427917","3427916","3427926","3427920","3427931","3427918","3427928","3427922","3427933","3427910","3427905","3427929","3427924","3427943","3427948","3427940","3427936","3427941","3427949","3427907","3427947","3427945","3427951","3427954","3427963","3427964","3427939","3427970","3427965","3427973","3427976","3427962","3427980","3427979","3427983","3427988","3427985","3427995","3427998","3428003","3428002","3427987","3428009","3428001","3428007","3428011","3428004","3428006","3428000","3428023","3428008","3428018","3427991","3428034","3428035","3428038","3428036","3428031","3428041","3428043","3428039","3427956","3428053","3428047","3428052","3428044","3428048","3428055","3428065","3428061","3428051","3428066","3428060","3428058","3428046","3428067","3428073","3428032","3428079","3428083","3428077","3428086","3428084","3428080","3428095","3428088","3428098","3428105","3428107","3428112","3428119","3427848","3428114","3428103","3428109","3428113","3428076","3428110","3428117","3428096","3428126","3428138","3428122","3428116","3428125","3428137","3428128","3427994","3428134","3428144","3428150","3428145","3428146","3428141","3428148","3428143","3428147","3428158","3428154","3428159","3428151","3428162","3428142","3428153","3428111","3428173","3428171","3428163","3428172","3428157","3428176","3428177","3428174","3428169","3428175","3428179","3428168","3428188","3428182","3428189","3428160","3428195","3428185","3428199","3428191","3428197","3428200","3428194","3428207","3428180","3428212","3428211","3428209","3428215","3428222","3428204","3428221","3428223","3428225","3428216","3428224","3428236","3428238","3428229","3428228","3428240","3428226","3428220","3428243","3428247","3428250","3428249","3428245","3428218","3428257","3428248","3428255","3428246","3428258","3428264","3428259","3428263","3428265","3428254","3428242","3428271","3428275","3428272","3428267","3428277","3428281","3428283","3428278","3428284","3428285","3428295","3428292","3428288","3428291","3428294","3428296","3428279","3428305","3428293","3428287","3428301","3428300","3428308","3428302","3428311","3428304","3428312","3428317","3428306","3428307","3428320","3428325","3428298","3428314","3428330","3428328","3428332","3428324","3428316","3428337","3428333","3428346","3428340","3428352","3428353","3428335","3428338","3428342","3428361","3428339","3428364","3428367","3428365","3428351","3428356","3428349","3428380","3428382","3428381","3428384","3428374","3428379","3428383","3428390","3428398","3428378","3428385","3428391","3428395","3428404","3428368","3428408","3428376","3428403","3428406","3428416","3427958","3428414","3428409","3428418","3428412","3428417","3428421","3428415","3428429","3428424","3428433","3428431","3428430","3428425","3428439","3428441","3428423","3428438","3428448","3428449","3428440","3428450","3428453","3428459","3428452","3428464","3428460","3428201","3428468","3428469","3428475","3428470","3428252","3428466","3428478","3428479","3428474","3428482","3428484","3428455","3428490","3428493","3428499","3428496","3428502","3428444","3428498","3428501","3428494","3428298","3428314","3428330","3428328","3428332","3428324","3428316","3428337","3428333","3428346","3428340","3428352","3428353","3428335","3428338","3428342","3428361","3428339","3428364","3428367","3428365","3428351","3428356","3428349","3428380","3428382","3428381","3428384","3428374","3428379","3428383","3428390","3428398","3428378","3428385","3428391","3428395","3428404","3428368","3428408","3428376","3428403","3428406","3428416","3427958","3428414","3428409","3428418","3428412","3428417","3428421","3428415","3428429","3428424","3428433","3428431","3428430","3428425","3428439","3428441","3428423","3428438","3428448","3428449","3428440","3428450","3428453","3428459","3428452","3428464","3428460","3428201","3428468","3428469","3428475","3428470","3428252","3428466","3428478","3428479","3428474","3428482","3428484","3428455","3428490","3428493","3428499","3428496","3428502","3428444","3428498","3428501","3428494","3428505","3428504","3428503","3428489","3428510","3428507","3428492","3428512","3428514","3428516","3428527","3428523","3428462","3428525","3428531","3428532","3428536","3428545","3428542","3428528","3428548","3428556","3428544","3428526","3428553","3428547","3428554","3428551","3428565","3428563","3428555","3428520","3428567","3428568","3428570","3428251","3428586","3428579","3428589","3428588","3428592","3428576","3428578","3428600","3428488","3428598","3428602","3428599","3428614","3428607","3428609","3428580","3428605","3428618","3428530","3428617","3428620","3428616","3428604","3428621","3428639","3428569","3428603","3428636","3428638","3428635","3428626","3428622","3428625","3428643","3428585","3428634","3428651","3428648","3428653","3428632","3428647","3428633","3428650","3428661","3428664","3428665","3428668","3428644","3428673","3428672","3428676","3428671","3428684","3428678","3428683","3428685","3428688","3428690","3428679","3428691","3428697","3428692","3428693","3428705","3428701","3428708","3428694","3428703","3428706","3428712","3428710","3428709","3428715","3428721","3428725","3428722","3428615","3428731","3428726","3428720","3428730","3428729","3428737","3428739","3428732","3428741","3428740","3428745","3428713","3428733","3428751","3428734","3428757","3428762","3428760","3428766","3428749","3428768","3428765","3428767","3428769","3428773","3428772","3428785","3428781","3428784","3428780","3428788","3428761","3428796","3428774","3428778","3428795","3428798","3428800","3428801","3428797","3428809","3428812","3428794","3428813","3428822","3428823","3428820","3428826","3428803","3428792","3428835","3428825","3428817","3428831","3428836","3428834","3428844","3428829","3428843","3428845","3428849","3428753","3428850","3428853","3428830","3428858","3428867","3428847","3428839","3428860","3428861","3428854","3428872","3428857","3428859","3428870","3428875","3428877","3428879","3428890","3428889","3428881","3428841","3428882","3428885","3428894","3428887","3428893","3428886","3428896","3428895","3428884","3428902","3428900","3428892","3428903","3428921","3428912","3428914","3428898","3428906","3428911","3428923","3428920","3428932","3428924","3428927","3428918","3428938","3428941","3428936","3428930","3428946","3428935","3428871","3427887","3428919","3428957","3428951","3428956","3428942","3428960","3428958","3428964","3428965","3428967","3428966","3428969","3428970","3428972","3428980","3428832","3428982","3428985","3428976","3428991","3428984","3428986","3428994","3428990","3428993","3428978","3429001","3429000","3428999","3428997","3428998","3429013","3429009","3429007","3429012","3428996","3429011","3429002","3429017","3428407","3429016","3429008","3429006","3429025","3429018","3429028","3429027","3428348","3429034","3429021","3429026","3428989","3429035","3429038","3429042","3429036","3429040","3429052","3429044","3429057","3429043","3429059","3429054","3429046","3429045","3429058","3429055","3429065","3429070","3429062","3429064","3429068","3429081","3429080","3429077","3429063","3429084","3429087","3429091","3429088","3429069","3429090","3429093","3429100","3429097","3429094","3429109","3429104","3429110","3429113","3429111","3429107","3429108","3429120","3429119","3429118","3429123","3429023","3429121","3429124","3429115","3429130","3429129","3429132","3429135","3429133","3429131","3429148","3429137","3429154","3429145","3429155","3429152","3429142","3429092","3429151","3429162","3429138","3429168","3429159","3429171","3429147","3429177","3429179","3429176","3429174","3429163","3429184","3429169","3429195","3429173","3429187","3429164","3429183","3429200","3429198","3429203","3429196","3429182","3429199","3429205","3429207","3429206","3429208","3429212","3429213","3429211","3429209","3429219","3429220","3429204","3429214","3428995","3429221","3429225","3429226","3429232","3429229","3429235","3429228","3429231","3429106","3429227","3429237","3429230","3429251","3429249","3429217","3429255","3429257","3429258","3429234","3429260","3429238","3429261","3429269","3429270","3429266","3429271","3429262","3429279","3429275","3429277","3429283","3429282","3429284","3429289","3429294","3429295","3429293","3429298","3429299","3429274","3429290","3429302","3429303","3429301","3429306","3429305","3429304","3429307","3429309","3429312","3429265","3429318","3429319","3429317","3429325","3429326","3429031","3429327","3429332","3429328","3429335","3429340","3429329","3429334","3429336","3429286","3429343","3429344","3429345","3429331","3429350","3429353","3429355","3429357","3429356","3429349","3429359","3429358","3429346","3429365","3429364","3429362","3429373","3429367","3429368","3429372","3429377","3429380","3429384","3429381","3429385","3429387","3429390","3429397","3429394","3429399","3429400","3429404","3429403","3429393","3429391","3429410","3429409","3429413","3429398","3429414","3429416","3429418","3429415","3429424","3429411","3429434","3429435","3429443","3429436","3429437","3429445","3429447","3429446","3429442","3429457","3429458","3429449","3429460","3429464","3429462","3429459","3429472","3429469","3429470","3429468","3429477","3429475","3429441","3429428","3429484","3429480","3429485","3429488","3429489","3429493","3429492","3429497","3429501","3429505","3429506","3429510","3429490","3429514","3429518","3429516","3429517","3429521","3429519","3429531","3429533","3429527","3429524","3429528","3429537","3429498","3429536","3429534","3429544","3429538","3429547","3429523","3429546","3429551","3429554","3429557","3429561","3429559","3429565","3429566","3429564","3429558","3429574","3429573","3429571","3429580","3429582","3429584","3429589","3429578","3429591","3429597","3429595","3429599","3429593","3429601","3429600","3429605","3429608","3429611","3429616","3429617","3429618","3429622","3429628","3429627","3429626","3429630","3429632","3429635","3429637","3429634","3429638","3429636","3429633","3429641","3429642","3429643","3429645","3429647","3429650","3429652","3429651","3429657","3429659","3429654","3429662","3429658","3429663","3429666","3429667","3429668","3429669","3429665","3429671","3429674","3429679","3429676","3429681","3429680","3429682","3429683","3429686","3429687","3429691","3429696","3429685","3429698","3429699","3429705","3429707","3429709","3429710","3429712","3429713","3429714","3429718","3429715","3429722","3429723","3429726","3429730","3429727","3429731","3429736","3429739","3429742","3429743","3429746","3429748","3429749","3429752","3429751","3429756","3429760","3429745","3429750","3429764","3429761","3429763","3429769","3429762","3429773","3429775","3429765","3429777","3429778","3429779","3429782","3429787","3429788","3429792","3429794","3429793","3429797","3429800","3429796","3429801","3429805","3429799","3429809","3429813","3429814","3429818","3429820","3429825","3429827","3429826","3429833","3429834","3429838","3429839","3429840","3429846","3429848","3429849","3429850","3429854","3429856","3429853","3429857","3429866","3429869","3430208","3430194","3430212","3430219","3430217","3430223","3430210","3430225","3430229","3430230","3430228","3430231","3430227","3430137","3430220","3428372","3430239","3430209","3430242","3430245","3430251","3428476","3430249","3430254","3430248","3430256","3430260","3430255","3430263","3430233","3430235","3430261","3430268","3430271","3430240","3430285","3430281","3430267","3430291","3430278","3430290","3430297","3430296","3430294","3430300","3430295","3430307","3430308","3430311","3430315","3430314","3430317","3430320","3430318","3429548","3430324","3430325","3430322","3430329","3430332","3430316","3430259","3430335","3430326","3430343","3430339","3430344","3430334","3430340","3430342","3430341","3430347","3430348","3430338","3430353","3430346","3430355","3430045","3430046","3430050","3430052","3430053","3429102","3430055","3430054","3430047","3430044","3430026","3430068","3430067","3430062","3430065","3430063","3430072","3430076","3430077","3430069","3430080","3430084","3430082","3430087","3430088","3430089","3430094","3430093","3430081","3430098","3430103","3430105","3430110","3430107","3430114","3430121","3430124","3430126","3430104","3430127","3430113","3430130","3430129","3430120","3430131","3430123","3430135","3430136","3430134","3430133","3430143","3430106","3430145","3430153","3430156","3430159","3430155","3430165","3430154","3430161","3430171","3430176","3430164","3430174","3430175","3430167","3430183","3430188","3430184","3430187","3430192","3430195","3430197","3430201","3428022","3430182","3430202","3430203","3430207","3430362","3430354","3430359","3430364","3430363","3430365","3430361","3430376","3430369","3430377","3430380","3430367","3430374","3430373","3430371","3430379","3430385","3430382","3430389","3430381","3430393","3430400","3430398","3430406","3430370","3430408","3430397","3430402","3430405","3430391","3430403","3430394","3430414","3430415","3430416","3430417","3430418","3430420","3430407","3430423","3430431","3430427","3430428","3430438","3430356","3430440","3430447","3430445","3430448","3430442","3430457","3430458","3430466","3430463","3430459","3430469","3430468","3430508"];
        
        // 进行实名认证
        $driverArr = array_merge($real_name_id,$no_real_name_id);

        // 19:50:00 -- 08:10:00数据
        $allDriverArr = ["3427634","3427642","3427653","3427670","3427683","3427664","3427707","3427705","3427697","3427706","3427696","3427708","3427703","3427712","3427719","3427725","3427726","3427717","3427722","3427709","3427679","3427720","3427730","3427689","3427743","3427741","3427699","3427727","3427723","3427737","3427734","3427744","3427752","3427740","3427736","3427746","3427732","3427733","3427751","3427759","3427750","3427756","3427765","3427758","3427764","3427766","3427753","3427768","3427770","3427763","3427747","3427769","3427771","3427777","3427735","3427786","3427773","3427780","3427784","3427785","3427781","3427778","3427739","3427790","3427794","3427795","3427799","3427791","3427787","3427792","3427797","3427805","3427802","3427804","3427809","3427817","3427811","3427814","3427808","3427816","3427815","3427813","3427820","3427810","3427821","3427826","3427827","3427831","3427819","3427830","3427824","3427818","3427835","3427833","3427834","3427839","3427843","3427845","3427841","3427823","3427847","3427850","3427652","3427829","3427807","3427854","3427849","3427855","3427861","3427865","3427862","3427863","3427867","3427846","3427868","3427871","3427879","3427869","3427864","3427872","3427866","3427874","3427888","3427876","3427767","3427885","3427886","3427894","3427892","3427896","3427900","3427884","3427897","3427898","3427902","3427915","3427901","3427917","3427916","3427926","3427923","3427919","3427909","3427920","3427931","3427918","3427928","3427922","3427933","3427910","3427905","3427929","3427924","3427943","3427948","3427942","3427940","3427936","3427911","3427941","3427938","3427949","3427907","3427947","3427945","3427951","3427954","3427963","3427964","3427967","3427939","3427970","3427965","3427973","3427976","3427962","3427977","3427980","3427979","3427983","3427988","3427985","3427986","3427990","3427996","3427995","3427998","3428003","3428002","3427987","3428009","3428001","3428007","3428011","3428004","3427999","3427989","3428006","3428010","3428000","3428023","3428008","3428018","3427974","3427991","3428034","3428035","3428038","3428036","3428031","3428024","3428041","3428043","3428039","3427956","3428053","3428047","3428050","3428052","3428044","3428048","3428055","3428064","3428056","3428065","3428061","3428051","3428066","3428060","3428013","3428058","3428046","3428054","3428067","3428073","3428032","3428079","3428083","3428078","3428082","3428077","3428074","3428086","3428084","3428080","3428092","3428095","3428088","3428090","3428098","3428105","3428107","3428112","3428119","3427848","3428114","3428103","3428109","3428113","3428076","3428110","3428117","3428124","3428096","3428126","3428127","3428138","3428122","3428116","3428125","3428137","3428128","3427994","3428134","3428144","3428140","3428150","3428145","3428146","3428141","3428148","3428143","3428147","3428149","3428158","3428154","3428159","3428151","3428162","3428142","3428153","3428111","3428173","3428171","3428163","3428172","3428157","3428161","3428176","3428177","3428174","3428169","3428175","3428179","3428133","3428181","3428168","3428183","3428188","3428182","3428129","3428189","3428160","3428195","3428185","3428199","3428191","3428197","3428200","3428194","3428207","3428180","3428212","3428211","3428209","3428215","3428170","3428222","3428204","3428221","3428223","3428225","3428216","3428224","3428217","3428237","3428236","3427997","3428238","3428229","3428228","3428240","3428226","3428220","3428244","3428243","3428247","3428250","3428249","3428245","3428218","3428257","3428248","3428255","3428246","3428258","3428264","3428259","3428263","3428265","3428260","3428254","3428242","3428261","3428271","3428275","3428272","3428267","3428268","3428277","3428281","3428283","3428278","3428284","3428285","3428295","3428292","3428288","3428291","3428294","3428297","3428296","3428273","3428279","3428305","3428293","3428287","3428301","3428300","3428308","3428302","3428311","3428304","3428312","3428317","3428306","3428307","3428320","3428326","3428325","3428298","3428314","3428330","3428328","3428332","3428324","3428316","3428337","3428333","3428346","3428340","3428352","3428334","3428353","3428335","3428338","3428342","3428361","3428339","3428364","3428367","3428365","3428351","3428356","3428377","3428349","3428380","3428382","3428381","3428384","3428357","3428374","3428379","3428373","3428383","3428390","3428398","3428378","3428385","3428391","3428395","3428404","3428368","3428408","3428376","3428403","3428406","3428416","3427958","3428414","3428409","3428418","3428412","3428417","3428421","3428415","3428345","3428429","3428424","3428433","3428431","3428430","3428425","3428439","3428441","3428423","3428438","3428448","3428449","3428440","3428450","3428453","3428459","3428452","3428464","3428460","3428201","3428468","3428469","3428465","3428475","3428470","3428252","3428466","3428478","3428479","3428474","3428482","3428484","3428455","3428490","3428493","3428495","3428499","3428496","3428502","3428444","3428498","3428501","3428494","3428505","3428504","3428503","3428489","3428510","3428507","3428492","3428512","3428514","3428513","3428516","3428527","3428523","3428462","3428525","3428531","3428532","3428535","3428536","3428545","3428542","3428528","3428548","3428556","3428544","3428526","3428553","3428537","3428547","3428554","3428543","3428551","3428565","3428563","3428555","3428520","3428567","3428568","3428570","3428566","3428251","3428586","3428579","3428589","3428588","3428571","3428592","3428576","3428578","3428600","3428488","3428598","3428602","3428599","3428612","3428614","3428607","3428552","3428609","3428580","3428605","3428618","3428530","3428617","3428620","3428616","3428604","3428621","3428639","3428569","3428603","3428636","3428638","3428635","3428626","3428622","3428625","3428643","3428585","3428634","3428651","3428648","3428653","3428632","3428647","3428633","3428650","3428661","3428664","3428657","3428658","3428665","3428668","3428644","3428673","3428675","3428672","3428676","3428671","3428656","3428659","3428684","3428678","3428683","3428685","3428688","3428690","3428679","3428691","3428697","3428692","3428693","3428700","3428705","3428701","3428708","3428694","3428703","3428706","3428712","3428710","3428709","3428715","3428721","3428725","3428722","3428615","3428731","3428704","3428726","3428720","3428730","3428729","3428667","3428737","3428739","3428732","3428741","3428740","3428745","3428713","3428733","3428735","3428751","3428734","3428750","3428757","3428762","3428760","3428756","3428766","3428749","3428768","3428765","3428767","3428769","3428759","3428773","3428772","3428785","3428781","3428784","3428780","3428788","3428761","3428796","3428774","3428778","3428795","3428798","3428800","3428801","3428797","3428809","3428812","3428794","3428813","3428822","3428823","3428824","3428820","3428826","3428803","3428792","3428835","3428825","3428817","3428831","3428836","3428834","3428844","3428829","3428843","3428845","3428849","3428753","3428850","3428853","3428830","3428858","3428867","3428847","3428839","3428860","3428861","3428854","3428872","3428857","3428859","3428865","3428870","3428875","3428877","3428879","3428890","3428889","3428881","3428878","3428873","3428841","3428882","3428885","3428894","3428887","3428893","3428886","3428896","3428895","3428884","3428902","3428900","3428901","3428892","3428903","3428910","3428921","3428912","3428914","3428898","3428906","3428911","3428923","3428920","3428929","3428932","3428908","3428924","3428927","3428905","3428917","3428918","3428938","3428941","3428936","3428939","3428930","3428946","3428935","3428909","3428871","3427887","3428919","3428943","3428957","3428951","3428956","3428942","3428960","3428925","3428958","3428962","3428964","3428965","3428949","3428967","3428966","3428969","3428970","3428972","3428980","3428832","3428982","3428985","3428976","3428991","3428984","3428986","3428994","3428990","3428993","3428978","3429001","3429000","3428999","3428997","3428998","3429013","3429009","3429007","3429012","3428996","3429011","3429002","3429017","3428407","3429016","3429008","3429004","3429006","3429020","3429025","3429018","3429024","3429028","3429027","3428348","3429034","3429021","3429026","3428989","3429035","3429038","3429042","3429036","3429033","3429039","3429040","3429052","3429044","3429057","3429043","3429059","3429054","3429046","3429050","3429045","3429058","3429055","3429065","3429070","3429062","3429064","3429068","3429081","3429080","3429077","3429061","3429063","3429071","3429084","3429087","3429091","3429088","3429069","3429090","3429093","3429100","3429097","3429094","3429109","3429104","3429110","3429113","3429111","3429107","3429108","3429120","3429119","3429118","3429123","3429023","3429121","3429124","3429115","3429130","3429129","3429126","3429134","3429132","3429135","3429133","3429131","3429148","3429137","3429154","3429145","3429155","3429152","3429142","3429158","3429092","3429151","3429162","3429138","3429168","3429159","3429141","3429171","3429147","3429177","3429179","3429181","3429176","3429174","3429163","3429184","3429169","3429195","3429173","3429188","3429187","3429164","3429172","3429183","3429200","3429198","3429203","3429196","3429182","3429199","3429205","3429207","3429206","3429208","3429212","3429197","3429213","3429211","3429209","3429219","3429220","3429204","3429214","3428995","3429221","3429225","3429226","3428842","3429232","3429229","3429235","3429228","3429231","3429106","3429227","3429237","3429230","3429251","3429249","3429217","3429117","3429255","3429244","3429257","3429258","3429234","3429260","3429238","3429261","3429269","3429270","3429266","3429271","3429262","3429279","3429275","3429277","3429283","3429282","3429284","3429289","3429294","3429295","3429293","3429298","3429299","3429274","3429290","3429302","3429303","3429301","3429306","3429305","3429304","3429307","3429309","3429315","3429312","3429265","3429318","3429319","3429317","3429325","3429326","3429031","3429327","3429332","3429328","3429335","3429340","3429330","3429329","3429334","3429336","3429286","3429343","3429344","3429345","3429331","3429350","3429333","3429353","3429347","3429355","3429357","3429356","3429354","3429349","3429359","3429358","3429339","3429346","3429365","3429361","3429364","3429362","3429373","3429367","3429368","3429372","3429377","3429370","3429380","3429379","3429384","3429381","3429385","3429387","3429390","3429397","3429394","3429399","3429392","3429400","3429404","3429403","3429393","3429391","3429402","3429410","3429409","3429413","3429398","3429414","3429412","3429416","3429418","3429415","3429424","3429419","3429425","3429411","3429434","3429435","3429443","3429436","3429437","3429445","3429447","3429446","3429442","3429451","3429457","3429458","3429449","3429460","3429464","3429462","3429459","3429461","3429472","3429469","3429470","3429468","3429477","3429476","3429475","3429441","3429428","3429484","3429480","3429485","3429488","3429489","3429493","3429492","3429497","3429501","3429505","3429504","3429506","3429508","3429510","3429490","3429514","3429515","3429518","3429516","3429517","3429521","3429522","3429519","3429531","3429526","3429533","3429527","3429524","3429528","3429537","3429498","3429536","3429534","3429544","3429538","3429547","3429523","3429541","3429539","3429546","3429551","3429545","3429554","3429557","3429561","3429559","3429565","3429566","3429564","3429558","3429574","3429573","3429571","3429580","3429582","3429584","3429589","3429576","3429578","3429591","3429597","3429595","3429599","3429593","3429601","3429600","3429605","3429608","3429604","3429611","3429616","3429617","3429618","3429622","3429624","3429628","3429627","3429626","3429630","3429632","3429635","3429637","3429634","3429638","3429636","3429633","3429641","3429642","3429639","3429643","3429645","3429647","3429650","3429652","3429651","3429657","3429655","3429653","3429659","3429654","3429662","3429658","3429663","3429666","3429667","3429668","3429669","3429665","3429671","3429674","3429672","3429679","3429676","3429681","3429680","3429682","3429683","3429686","3429687","3429691","3429693","3429696","3429685","3429698","3429699","3429705","3429707","3429709","3429710","3429712","3429713","3429714","3429718","3429715","3429720","3429722","3429723","3429726","3429724","3429730","3429727","3429731","3429736","3429739","3429742","3429743","3429746","3429748","3429749","3429752","3429751","3429756","3429760","3429745","3429750","3429764","3429761","3429763","3429769","3429762","3429773","3429775","3429765","3429774","3429777","3429778","3429779","3429780","3429782","3429787","3429788","3429792","3429791","3429794","3429793","3429797","3429800","3429796","3429801","3429805","3429799","3429809","3429813","3429814","3429812","3429818","3429820","3429819","3429823","3429825","3429827","3429826","3429833","3429834","3429832","3429838","3429839","3429840","3429846","3429847","3429848","3429849","3429850","3429854","3429856","3429853","3429857","3429859","3429862","3429866","3429869","3429870","3429872","3429873","3429871","3429880","3429879","3429883","3429884","3429886","3429888","3429891","3429890","3429896","3429901","3429897","3429899","3429903","3429904","3429905","3429910","3429911","3429908","3429913","3429916","3429917","3429918","3429921","3429922","3429923","3429926","3429925","3429924","3429912","3429928","3429937","3429938","3429942","3429941","3429944","3429946","3429947","3429949","3429953","3429894","3429954","3429952","3429948","3429955","3429957","3429960","3429963","3429964","3429961","3429967","3429959","3429966","3429965","3429971","3429974","3429969","3429977","3429976","3429980","3429985","3429984","3429987","3429982","3429981","3429988","3429990","3429993","3429997","3429992","3429999","3430001","3430002","3430003","3430007","3430005","3430009","3430004","3430008","3430014","3430011","3430012","3430018","3430021","3430019","3430027","3430023","3430030","3430031","3430029","3430034","3430035","3430041","3430039","3430042","3430038","3430043","3430045","3430037","3430046","3430050","3430048","3430052","3430053","3429102","3430055","3430054","3430047","3430044","3430026","3430068","3430067","3430062","3430065","3430063","3430072","3430071","3427812","3430076","3430077","3430069","3430080","3430084","3430082","3430087","3430088","3430089","3430058","3430094","3430093","3430081","3430098","3430103","3430105","3430096","3430099","3430102","3430110","3430107","3430114","3430121","3430116","3430124","3430126","3430104","3430127","3430113","3430130","3430129","3430125","3430120","3430131","3430123","3430135","3430136","3430138","3430139","3430134","3430133","3430143","3430106","3430145","3430153","3430156","3430159","3430155","3430157","3430165","3430149","3430147","3430154","3430161","3430171","3430176","3430164","3430174","3430175","3430173","3430167","3430180","3430183","3430188","3430184","3430187","3430192","3430195","3430197","3430201","3428022","3430182","3430202","3430193","3430189","3430203","3430191","3430198","3430207","3430208","3430194","3430172","3430212","3430205","3430186","3430219","3430199","3430217","3430221","3430215","3430223","3430210","3430222","3430225","3430229","3430230","3430228","3430231","3430227","3430137","3430220","3428372","3430236","3430239","3430209","3430242","3430245","3430251","3428476","3430249","3430254","3430248","3430258","3430252","3430256","3430260","3430255","3430263","3430233","3430235","3430261","3430268","3430271","3430266","3430240","3430277","3430280","3430272","3430285","3430286","3430281","3430267","3430292","3428234","3430291","3430278","3430290","3430297","3430296","3430294","3430300","3430295","3430298","3430307","3430301","3430308","3430311","3430305","3430315","3430314","3430317","3430320","3430318","3430312","3429548","3430324","3430325","3430322","3430313","3430329","3430332","3430316","3430259","3430335","3430326","3430343","3430339","3430344","3430334","3430340","3430342","3430341","3430347","3430348","3430338","3430330","3430353","3430346","3430355","3430362","3430354","3430359","3430364","3430363","3430365","3430361","3430376","3430369","3430375","3430377","3430380","3430367","3430374","3430373","3430371","3430379","3430385","3430382","3430389","3430388","3430381","3430393","3430400","3430398","3430406","3430370","3430408","3430397","3430402","3430405","3430391","3430403","3430394","3430414","3430415","3430416","3430417","3430418","3430420","3430407","3430423","3430431","3430427","3430428","3430433","3430438","3429975","3430356","3430443","3430440","3430447","3430445","3430448","3430442","3430449","3430457","3430458","3430466","3430450","3430463","3430459","3430469","3430468","3430508","3428928","3428166"];
        // 19:50:00 -- 20:00:00 和 08:00:00 -- 08:10:00
        $driverId1 = ["3427634","3427642","3427653","3427670","3427683","3427664","3427697","3427696","3427703","3427679","3427689","3427699","3427652","3430469","3430508"];
        // 20:00:00 -- 08:00:00 (异常司机ID)
        $driverId2 = array_diff($allDriverArr, $driverId1);
        
        $driverData = DriverModel::select('*')->whereIn('driver_join_id',$driverId2)->get()->toArray();
        // 
        $insert_driver_real_name = [];
        foreach ($driverData as $key => $value){
            $insert_driver_real_name[$value['driver_join_id']] = $value;
        }

        // 获得实名认证不通过的sql
        $no_real_name_diff = array_intersect($no_real_name_id, $driverId2);
        $update_driver = ["3427386","3427386","3427698","3427698","3427694","3427694","3427686","3427686","3427664","3423465","3427694","3427673","3427673","2688802","3193559","3427770","3427662","3427821","3427266","3427821","3427723","3427854","3427879","3427767","3427876","3427896","3427922","3427949","3407977","3407977","3428052","3376062","3427696","3427980","3428113","3381746","3426561","3409284","3428283","3428283","3428371","3428404","3428391","3428478","3428470","3428510","3428490","3428553","3428525","3428547","3428520","3428551","3428251","3428603","3428495","3428602","3428636","3428598","3086035","3428672","3428668","3428749","3428835","3326589","3428867","3428885","3428941","3428938","3428825","3428939","3428939","3428228","3428994","3428879","3429020","3429080","3429088","3429025","3429174","3429187","3429177","3421950","3429199","3429207","3429261","3386147","3429387","3429421","2959034","3421822","3421822","3429447","3429465","3429672","2413790","3429709","3429761","3429764","3429818","3429818","3429827","3429251","3429251","3429884","3429884","3427980","3428444","3429643","3429174","3430045","3430026","3408740","3424007","3428022","2533652","3430312","3372609","3430376","3430388","3430415","3430370","3430394","3430233","3427236"];
        $diff_driver = array_diff($driverId2, $update_driver);
        $diff_no_real_name = array_intersect($diff_driver, $no_real_name_id);
        $diff_real_name = array_intersect($diff_driver, $real_name_id);
        
        
        
        // 
//        $diff_no_real_name = [3429870,3429871,3429908,429941,3429957,3429966,3429988,3429992,3430004,3430035,3430038];
//        $diff_real_name = ["3429872","3429873","3429880","3429879","3429883","3429884","3429886","3429888","3429891","3429890","3429896","3429901","3429897","3429899","3429903","3429904","3429905","3429910","3429911","3429913","3429916","3429917","3429918","3429921","3429922","3429923","3429926","3429925","3429924","3429912","3429928","3429937","3429938","3429942","3429944","3429946","3429947","3429949","3429953","3429894","3429954","3429952","3429948","3429955","3429960","3429963","3429964","3429961","3429967","3429959","3429965","3429971","3429974","3429969","3429977","3429976","3429980","3429985","3429984","3429987","3429982","3429981","3429990","3429993","3429997","3429999","3430001","3430002","3430003","3430007","3430005","3430009","3430008","3430014","3430011","3430012","3430018","3430021","3430019","3430027","3430023","3430030","3430031","3430029","3430034","3430041","3430039","3430042","3430043"];
//        $driverData = DriverModel::select('*')->whereIn('driver_join_id',array_merge($diff_no_real_name,$diff_real_name))->get()->toArray();
//        foreach ($driverData as $key => $value){
//            $insert_driver_real_name[$value['driver_join_id']] = $value;
//        }
        $a = $b = [];
        foreach ($diff_no_real_name as $key => $value){
            if(isset($insert_driver_real_name[$value])){
                array_push($a, $insert_driver_real_name[$value]);
            }
        }

        foreach ($diff_real_name as $key => $value){
            if(isset($insert_driver_real_name[$value])){
                array_push($b, $insert_driver_real_name[$value]);
            }
        }

//        `driver_join_no` varchar(48) COLLATE utf8_unicode_ci NOT NULL DEFAULT '' COMMENT '司机加盟申请编号',
//  `driver_join_id` int(10) NOT NULL DEFAULT '0' COMMENT '司机加盟申请ID',
//  `result` varchar(256) COLLATE utf8_unicode_ci NOT NULL DEFAULT '' COMMENT '查询结果',
//  `scene_description` varchar(256) COLLATE utf8_unicode_ci NOT NULL DEFAULT '' COMMENT '查询场景',
//  `create_time1` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '查询时间',
//  `search_name` varchar(128) COLLATE utf8_unicode_ci NOT NULL DEFAULT '' COMMENT '查询姓名',
//  `id_card_no` varchar(18) COLLATE utf8_unicode_ci NOT NULL DEFAULT '' COMMENT '身份证号',
//  `type` tinyint(4) NOT NULL DEFAULT '1' COMMENT '查询日志类型:1-身份证实名认证 2-案底查询',
//
        
        $sql = '';
        foreach ($a as $key => $value){
            $sql .= 'insert into  t_join_driver_validate_log  (driver_join_no,driver_join_id,result,scene_description,create_time,search_name,id_card_no,type) value ("'. $value['driver_join_no'].'",'. $value['driver_join_id'].',"实名认证不通过","司机注册实名认证","'.$value['create_time1'].'","'.$value['search_name'].'","'.$value['id_card_no'].'",1); ' . PHP_EOL;
        }

        foreach ($b as $key => $value){
            $sql .= 'insert into  t_join_driver_validate_log  (driver_join_no,driver_join_id,result,scene_description,create_time,search_name,id_card_no,type) value ("'. $value['driver_join_no'].'",'. $value['driver_join_id'].',"实名认证通过","司机注册实名认证","'.$value['create_time1'].'","'.$value['search_name'].'","'.$value['id_card_no'].'",1); ' . PHP_EOL;
        }



        echo $sql;
        die;




        
//        P(DriverModel::select('*')->whereIn('driver_join_id',$driverId1)->getSql());
        
        //        $
//        
//        $driver
//        $driverArr = array_intersect($real_name_id,$no_real_name_id);

        $driverArrNum = count(array_unique($driverArr));


        P($driverArrNum);
















    }


    public function getDriver(){
        $json_str = $this->request->getGet('json_str');
        $driverArr = json_decode($json_str,true);
        $driverId = array_column($driverArr['data'][0]['query0'], 'driver_join_id');
//        P($driverArr);
        echo json_encode($driverId);
    }
    
}
